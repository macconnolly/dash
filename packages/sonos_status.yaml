template:
  - sensor:
      - name: sonos_status
        state: >
          {% set players = ['media_player.living_room', 'media_player.kitchen', 'media_player.dining_room', 'media_player.master_bedroom', 'media_player.sun_house', 'media_player.bath'] %}
          {{ 'playing' if expand(players) | selectattr('state', 'eq', 'playing') | list | count > 0 else 'idle' }}
        attributes:
          active_count: >
            {% set players = ['media_player.living_room', 'media_player.kitchen', 'media_player.dining_room', 'media_player.master_bedroom', 'media_player.sun_house', 'media_player.bath'] %}
            {{ expand(players) | selectattr('state', 'eq', 'playing') | list | count }}
          current_track: >
            {% set players = ['media_player.living_room', 'media_player.kitchen', 'media_player.dining_room', 'media_player.master_bedroom', 'media_player.sun_house', 'media_player.bath'] %}
            {% set playing_player = expand(players) | selectattr('state', 'eq', 'playing') | first %}
            {% if playing_player %}
              {% set artist = state_attr(playing_player.entity_id, 'media_artist') %}
              {% set title = state_attr(playing_player.entity_id, 'media_title') %}
              {{ artist + ' - ' + title if artist and title else title if title else 'Playing' }}
            {% else %}
              None
            {% endif %}
script:
  sonos_preset_all_rooms:
    alias: Sonos Preset - All Rooms
    sequence:
      # Placeholder - Add actual Sonos grouping/playback actions
      - service: notify.persistent_notification
        data:
          message: "Sonos Preset 'All Rooms' activated (Placeholder)"
          title: "Sonos Preset"

  sonos_preset_kitchen_dining:
    alias: Sonos Preset - Kitchen & Dining
    sequence:
      # Placeholder - Add actual Sonos grouping/playback actions
      - service: notify.persistent_notification
        data:
          message: "Sonos Preset 'Kitchen & Dining' activated (Placeholder)"
          title: "Sonos Preset"

  sonos_preset_living_only:
    alias: Sonos Preset - Living Room Only
    sequence:
      # Placeholder - Add actual Sonos grouping/playback actions
      - service: notify.persistent_notification
        data:
          message: "Sonos Preset 'Living Room Only' activated (Placeholder)"
          title: "Sonos Preset"